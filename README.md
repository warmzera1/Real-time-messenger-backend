# üì® Messenger Core - –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π API-—Å–µ—Ä–≤–∏—Å –¥–ª—è –æ–±–º–µ–Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

###

<div align="center">
  <img src="https://cdn.jsdelivr.net/gh/devicons/devicon/icons/python/python-original.svg" height="30" alt="python logo"  />
  <img width="30" />
  <img src="https://cdn.jsdelivr.net/gh/devicons/devicon/icons/fastapi/fastapi-original.svg" height="30" alt="fastapi logo"  />
  <img width="30" />
  <img src="https://cdn.jsdelivr.net/gh/devicons/devicon/icons/postgresql/postgresql-original.svg" height="30" alt="postgresql logo"  />
  <img width="30" />
  <img src="https://cdn.jsdelivr.net/gh/devicons/devicon/icons/redis/redis-original.svg" height="30" alt="redis logo"  />
  <img width="30" />
  <img src="https://cdn.jsdelivr.net/gh/devicons/devicon/icons/pytest/pytest-original.svg" height="30" alt="pytest logo"  />
  <img width="30" />
  <img src="https://cdn.jsdelivr.net/gh/devicons/devicon/icons/docker/docker-original.svg" height="30" alt="docker logo"  />
  <img width="30" />
  <img src="https://cdn.jsdelivr.net/gh/devicons/devicon/icons/github/github-original.svg" height="30" alt="github logo"  />
</div>

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

  

- [–¶–µ–ª—å –ø—Ä–æ–µ–∫—Ç–∞](#—Ü–µ–ª—å-–ø—Ä–æ–µ–∫—Ç–∞)

- [–°—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π](#—Å—Ç–µ–∫-—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π)

- [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞](#—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–ø—Ä–æ–µ–∫—Ç–∞)

- [–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç](#–±—ã—Å—Ç—Ä—ã–π-—Å—Ç–∞—Ä—Ç)

- [API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](#api-–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è)

- [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–µ—à–µ–Ω–∏—è](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-–∏-—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ-—Ä–µ—à–µ–Ω–∏—è)

---

## üéØ –¶–µ–ª—å –ø—Ä–æ–µ–∫—Ç–∞

  

–ü—Ä–æ–µ–∫—Ç —Å–æ–∑–¥–∞–Ω –¥–ª—è –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–≥–æ –∏–∑—É—á–µ–Ω–∏—è WebSockets –∏ Redis –≤ —Ä–∞–º–∫–∞—Ö —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º. –û—Å–Ω–æ–≤–Ω–æ–µ –≤–Ω–∏–º–∞–Ω–∏–µ —É–¥–µ–ª–µ–Ω–æ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—é –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π backend-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –∏ –º–µ—Ö–∞–Ω–∏–∑–º–∞–º –Ω–∞–¥—ë–∂–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π.

  

##  üõ† –°—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π

  

-  **Core:** Python 3.11, FastAPI (Asynchronous)

-  **Storage:** PostgreSQL + SQLAlchemy 2.0 (Async Engine), Alembic

-  **Real-time & Cache:** Redis (Pub/Sub –¥–ª—è WebSockets, Caching)

- **QA:** Pytest (48 tests, Service & Router coverage)

- **DevOps:** Docker, Docker Compose, GitHub Actions (CI/CD)



## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

  
```text
name-folder/
‚îú‚îÄ‚îÄ .github/
‚îÇ   ‚îî‚îÄ‚îÄ workflows/
‚îÇ       ‚îî‚îÄ‚îÄ test.yml                 # CI: —Ç–µ—Å—Ç—ã
‚îÇ
‚îú‚îÄ‚îÄ backend/
‚îÇ   ‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ core/                    # –ë–∞–∑–æ–≤–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config.py            # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ security.py          # JWT, —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª—è
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dependencies/            # FastAPI –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ auth.py              # –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ models/                  # SQLAlchemy –º–æ–¥–µ–ª–∏ –ë–î
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ base.py              # –ë–∞–∑–æ–≤–∞—è –º–æ–¥–µ–ª—å
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ chat.py              # –ú–æ–¥–µ–ª—å —á–∞—Ç–æ–≤
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ message.py           # –ú–æ–¥–µ–ª—å —Å–æ–æ–±—â–µ–Ω–∏–π
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ participant.py       # –ú–æ–¥–µ–ª—å —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ user.py              # –ú–æ–¥–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ redis/                   # –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã —Å Redis
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ manager.py           # –ú–µ–Ω–µ–¥–∂–µ—Ä —Å–æ—Å—Ç–æ—è–Ω–∏—è
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ routes/                  # API endpoints
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.py              # –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ chat.py              # –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã —á–∞—Ç–æ–≤
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ messages.py          # –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã —Å–æ–æ–±—â–µ–Ω–∏–π
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ users.py             # –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ websocket.py         # WebSocket endpoint
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ schemas/                 # Pydantic —Å—Ö–µ–º—ã
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ chat.py              # –°—Ö–µ–º—ã —á–∞—Ç–æ–≤
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ message.py           # –°—Ö–µ–º—ã —Å–æ–æ–±—â–µ–Ω–∏–π
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ token.py             # –°—Ö–µ–º—ã —Ç–æ–∫–µ–Ω–æ–≤
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ user.py              # –°—Ö–µ–º—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services/                # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth_service.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ chat_service.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ message_service.py
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ utils/                   # –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ json_encoder.py
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ websocket/               # WebSocket-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ manager.py           # –ú–µ–Ω–µ–¥–∂–µ—Ä —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ database.py              # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SQLAlchemy
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ main.py                  # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ FastAPI
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ tests/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api.py                   # –¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ö–µ–º—ã / —Ö–µ–ª–ø–µ—Ä—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ integration/             # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services/                # –¢–µ—Å—Ç—ã —Å–µ—Ä–≤–∏—Å–æ–≤
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ unit/                    # Unit-—Ç–µ—Å—Ç—ã (–≤ —Ç.—á. WS)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ conftest.py              # –§–∏–∫—Å—Ç—É—Ä—ã
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ alembic.ini
‚îÇ   ‚îú‚îÄ‚îÄ docker-compose.yml
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile
‚îÇ   ‚îú‚îÄ‚îÄ entrypoint.sh
‚îÇ   ‚îú‚îÄ‚îÄ poetry.lock
‚îÇ   ‚îú‚îÄ‚îÄ poetry.toml
‚îÇ   ‚îú‚îÄ‚îÄ pytest.ini
‚îÇ   ‚îî‚îÄ‚îÄ README.md
|   ‚îî‚îÄ‚îÄ websocket.log

```

### üîç –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤


#### Backend (FastAPI)

  
| –ö–∞—Ç–∞–ª–æ–≥      | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                    |
| ------------ | ----------------------------- |
| core         |  –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ |
| dependencies | FastAPI –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏           |
| models       | ORM-–º–æ–¥–µ–ª–∏ –ë–î                 |
| redis        | –†–∞–±–æ—Ç–∞ —Å Redis                |
| routers      | HTTP API                      |
| schemas      | Pydantic-—Å—Ö–µ–º—ã                |
| services     | –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞                 |
| utils        | –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏       |
| websocket    | WebSocket –ª–æ–≥–∏–∫–∞              |
| database     | –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î              |
| main         | –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞                   |
| tests        | –¢–µ—Å—Ç—ã                         |
  

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

  

### –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ 

#### 1Ô∏è‚É£ –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```bash
git  clone  https://github.com/yourusername/Real-time-messenger-backend.git

cd  backend
```


#### 2Ô∏è‚É£ –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:

```bash
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env
cp .env.example .env
```

#### 3Ô∏è‚É£ –ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ Poetry:

```bash
poetry install        # —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
poetry shell          # –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –æ–∫—Ä—É–∂–µ–Ω–∏–µ
```

#### 4Ô∏è‚É£ –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∏—Å—Ç–µ–º—É —á–µ—Ä–µ–∑ Docker Compose:

```bash
docker-compose up -d --build
```

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–∏—Å –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É: **http://localhost:8000**

–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API (Swagger): **http://localhost:8000/docs**


  

## üìö API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

  

### –û—Å–Ω–æ–≤–Ω—ã–µ endpoints

  

#### Auth (–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è)

  
| –ú–µ—Ç–æ–¥ | Endpoint | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|----------|
| POST | `/auth/register` | –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| POST | `/auth/login` | –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| POST | `/auth/refresh` | –°–º–µ–Ω–∞ —Ç–æ–∫–µ–Ω–∞ |
| POST | `/auth/logout` | –í—ã—Ö–æ–¥ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞ |

  

#### Chat (–ß–∞—Ç)

  
| –ú–µ—Ç–æ–¥ | Endpoint | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|----------|
| POST | `/chats` | –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —á–∞—Ç–∞  |
| GET | `/chats` | –°–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è  |
| GET | `/chats/search` | –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| POST | `/auth/logout` | –í—ã—Ö–æ–¥ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞ |


#### Messages (–°–æ–æ–±—â–µ–Ω–∏—è)

 
| –ú–µ—Ç–æ–¥ | Endpoint | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|----------|
| POST | `/messages` | –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è  |
| GET | `/messages` | –ü–æ–ª—É—á–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ —á–∞—Ç–∞  |
| DELETE | `/messages/{message_id}/delete` | –£–¥–∞–ª–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç–µ |
| PATCH | `/messages/{message_id}/edit` | –ò–∑–º–µ–Ω–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç–µ |

#### Users (–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)

 
| –ú–µ—Ç–æ–¥ | Endpoint | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|----------|
| GET | `/users/me` | –ü–æ–ª—É—á–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è  |
  

### –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤

  

#### –ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–µ–∫—É—â–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ

  

```bash

curl  -X  GET  "http://localhost:8000/users/me"
Authorization: Bearer <YOUR_JWT_TOKEN>

```

  

**–û—Ç–≤–µ—Ç:**

  

```json
{

"id": 1,

"username": "user1",

"email": "u1@test.com",

"is_active": True,

"created_at": "2026-02-02T18:20:21",

}
```

  

#### –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ user1 -> user2

  

```bash

curl  -X  POST  "http://localhost:8000/messages"  \
Authorization: Bearer <YOUR_JWT_TOKEN>

-H "Content-Type: application/json" \

-d  '{

"chat_id":  2,

"content":  "test"

}'

```

  

**–û—Ç–≤–µ—Ç:**

  

```json
{

"id":  1,

"chat_id":  2,

"sender_id":  1,

"content":  "test",

"created_at":  "2026-02-08T18:10:12",

"delivered_at":  null,

"read_at":  null,

"is_delete":  false

}
```


–ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API —Å –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–º–∏ –ø—Ä–∏–º–µ—Ä–∞–º–∏ –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ –∞–¥—Ä–µ—Å—É:

**http://localhost:8000/api/docs** (Swagger UI)



## üèó –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–µ—à–µ–Ω–∏—è

### üì° –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—ã–π WebSocket (Redis Pub/Sub)

–î–ª—è —Ä–∞–±–æ—Ç—ã –≤ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–π —Å—Ä–µ–¥–µ (–ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∏–Ω—Å—Ç–∞–Ω—Å–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è) —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Å–ª–µ–¥—É—é—â–∞—è —Å—Ö–µ–º–∞ –æ–±–º–µ–Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏:

-   **Client ‚Üí Server A** ‚Äî —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ø–æ WebSocket.
    
-   **Server A ‚Üí Redis** ‚Äî –ø—É–±–ª–∏–∫–∞—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –∫–∞–Ω–∞–ª (Pub).
    
-   **Redis ‚Üí Server B/C/D** ‚Äî –≤—Å–µ –∏–Ω—Å—Ç–∞–Ω—Å—ã –ø–æ–ª—É—á–∞—é—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ (Sub).
    
-   **Server X ‚Üí Target Client** ‚Äî –¥–æ—Å—Ç–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –∫–æ–Ω–µ—á–Ω–æ–º—É –ø–æ–ª—É—á–∞—Ç–µ–ª—é.
    
    
_–î–∞–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –∏—Å–∫–ª—é—á–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É ¬´–ø–æ—Ç–µ—Ä—è–Ω–Ω—ã—Ö¬ª —Å–æ–æ–±—â–µ–Ω–∏–π, –µ—Å–ª–∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å –∏ –ø–æ–ª—É—á–∞—Ç–µ–ª—å –ø–æ–¥–∫–ª—é—á–µ–Ω—ã –∫ —Ä–∞–∑–Ω—ã–º —Å–µ—Ä–≤–µ—Ä–∞–º._


### üì© –û–±—Ä–∞–±–æ—Ç–∫–∞ offline-—Å–æ–æ–±—â–µ–Ω–∏–π

–°–∏—Å—Ç–µ–º–∞ —É—á–∏—Ç—ã–≤–∞–µ—Ç —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (**online / offline**):

-   **Online** ‚Äî –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ WebSocket-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è `Delivery Manager` –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ.
    
-   **Offline** ‚Äî –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–º–µ—â–∞–µ—Ç—Å—è –≤ –æ—á–µ—Ä–µ–¥—å (Redis Queue / List).
    
-   **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è** ‚Äî –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ (WebSocket Handshake) –∫–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ –æ—á–µ—Ä–µ–¥–∏, —á—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –¥–æ—Å—Ç–∞–≤–∫—É –¥–∞–∂–µ –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

### üõ† –ü–∞—Ç—Ç–µ—Ä–Ω—ã –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

-   **Service Layer** ‚Äî –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –æ—Ç–¥–µ–ª–µ–Ω–∞ –æ—Ç FastAPI-—Ä–æ—É—Ç–µ—Ä–æ–≤, —á—Ç–æ —É–ø—Ä–æ—â–∞–µ—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –≤—ã—Å–æ–∫–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ.
    
-   **Auth** ‚Äî —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –Ω–∞–¥—ë–∂–Ω–∞—è —Å—Ö–µ–º–∞ **Access / Refresh** —Ç–æ–∫–µ–Ω–æ–≤ —Å —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º –ø–∞—Ä–æ–ª–µ–π —á–µ—Ä–µ–∑ `bcrypt`.
    
-   **Reliability** ‚Äî entrypoint-—Å–∫—Ä–∏–ø—Ç—ã –≤ Docker –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É—é—Ç, —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ —Å—Ç–∞—Ä—Ç—É–µ—Ç –¥–æ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.

### üîç –û–±—â–∞—è —Å—Ö–µ–º–∞ –¥–æ—Å—Ç–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π

```mermaid
graph TD
    A[Client Sender] -->|WebSocket| B[FastAPI Backend]
    B --> C[(PostgreSQL)]
    B --> D{Redis Pub/Sub}
    D --> E[Delivery Manager]
    E -->|Online| F[Client Receiver]
    E -->|Offline| G[(Redis Queue)]

```

### üîå WebSocket Protocol

**Endpoint:** `/ws`  
**–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è:** `Authorization: Bearer <JWT>`

### Client ‚Üí Server


| Event | –û–ø–∏—Å–∞–Ω–∏–µ | 
|------|----------|
| message | –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è | 
| read | –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø—Ä–æ—á—Ç–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π (batch) | 
| edit_message | –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–Ω–µ–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è | 
| pong | –û—Ç–≤–µ—Ç –Ω–∞ heartbeat –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞ | 

### Server ‚Üí Client


| Event | –û–ø–∏—Å–∞–Ω–∏–µ | 
|------|----------|
| connected | –£—Å–ø–µ—à–Ω–æ–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ WebSocket-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è | 
| message | –ù–æ–≤–æ–µ –≤—Ö–æ–¥—è—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ | 
| message_edited | –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏—è | 
| error | –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–∞ | 
| ping | –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è | 

### –ì–∞—Ä–∞–Ω—Ç–∏–∏ –¥–æ—Å—Ç–∞–≤–∫–∏ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

-   **At-least-once delivery** ‚Äî —Å–æ–æ–±—â–µ–Ω–∏–µ –±—É–¥–µ—Ç –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–æ –º–∏–Ω–∏–º—É–º –æ–¥–∏–Ω —Ä–∞–∑
    
-   **Offline-–¥–æ—Å—Ç–∞–≤–∫–∞** ‚Äî –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –æ—Ñ—Ñ–ª–∞–π–Ω-—Å–æ–æ–±—â–µ–Ω–∏–π —á–µ—Ä–µ–∑ Redis-–æ—á–µ—Ä–µ–¥–∏
    
-   **Persistence** ‚Äî —Å—Ç–∞—Ç—É—Å—ã –¥–æ—Å—Ç–∞–≤–∫–∏ –∏ –ø—Ä–æ—á—Ç–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ë–î
    
-   **Rate limiting** ‚Äî –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —á–∞—Å—Ç–æ—Ç—ã –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
    
-   **Heartbeat** ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
    
-   **Stateless backend** ‚Äî —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π —Ö—Ä–∞–Ω–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ Redis


## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

  

### Backend —Ç–µ—Å—Ç—ã (pytest)

  
```bash
cd  backend

poetry run pytest
```
<div  align="center">

[![GitHub](https://img.shields.io/badge/GitHub-100000?style=for-the-badge&logo=github&logoColor=white)](https://github.com/warmzera1)

</div>
